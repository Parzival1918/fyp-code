# create-CmuMD-sim

Create a constant chemical potential molecular dynamics simulation from scratch.

Scripts are based on code from Dr. Stephen Yeandel.

Steps to create new simulation:

1. Add the created slabs and solutions to the `slabs/` and `solutions/` folders, respectively. If the folders do not exist create them and then add symlinks from `1-attach-solution/` to both `slabs/` and `solutions/` and from `2-attach-reservoir/` to `solutions/` only. Do the symlink with `ln -s ../slabs ./slabs``and equivalently with `solutions/`.
2. In the file `input.lmp` in `1-attach-reservoir/` change the variables `sol` and `slab` to solution and slabs that you put in the folders in the previous step. Change variable `frezze` to a height that covers the whole slab, and variable `sol_shift` to a shift in z so that the solution does not overlap with the slab. Send this job to run to the HPC.
3. Once the job is done, copy the newly created `prod_data.lmp` file to the folder `2-attach-reservoir/` with the name `data.lmp`. In the file `input.lmp` in the folder `2-attach-reservoir/` change the `res` variable to a solution that you put in the `solutions/` folder in the first step. Also change variable `freeze` to a height that covers the slab and the solution added in the second step, and change `res_shift` to a shift in z so that the reservoir is added above the solution and there is no overlap. Send the simulation to run in the HPC.
4. Once the simulation is done copy the newly created file `prod_data.lmp` to the folder `3-CmuMD` with the name `data.lmp`. Then modify the `plumed_creator.input` file to the required values. The file must have 4 lines with `CONCENTRATION [VALUE]` first, the concentration must be set in atoms/nm^3, then `FIXED [VALUE]` which is the position of the solid-liquid interface in fraction of the simulation cell, then `DCR [VALUE]` which is the distance from the interface to the innermost edge of the control region, also in fractional units, and finally `CRSIZE [VALUE]` which is the size of the control region such that the edge of the reservoir is equal to `DCR + CRSIZE`, also in fractional units. Once the values of the input file have been modified, run the `plumed_creator.py` script to create the `plumed.in` file required to run the CmuMD simulation. Run the file with `python3 plumed_creator.py`, this file does not have any extra dependencies that are not already installed with all python3 3.x versions, so no need to create a virtual environment.
5. Once the `plumed.in` file is created copy the required potential file from the `potentials/` folder. The `3-CmuMD/` folder will now contain all the files to run a new CmuMD simulation of the KNO3 system.
